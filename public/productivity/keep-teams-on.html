<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Keep Teams Active</title>
  <!-- Favicon: An active status indicator -->
  <link rel="icon"
    href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='40' fill='%2310b981'/%3E%3Ccircle cx='50' cy='50' r='25' fill='%23ffffff'/%3E%3Ccircle cx='50' cy='50' r='15' fill='%2310b981'/%3E%3C/svg%3E"
    type="image/svg+xml">
  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            'mono': ['Monaco', 'Menlo', 'Ubuntu Mono', 'monospace'],
          }
        }
      }
    }
  </script>
</head>

<body class="bg-gray-50 min-h-screen font-mono text-gray-800">
  <div class="container mx-auto px-4 py-8 max-w-4xl">
    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold text-gray-900 mb-2">Keep Teams Active</h1>
      <p class="text-gray-600">Prevent Microsoft Teams from going idle with automated activity simulation</p>
    </div>

    <!-- Main Control Panel -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center space-x-3">
          <div id="statusIndicator" class="w-3 h-3 bg-emerald-500 rounded-full animate-pulse"></div>
          <span class="text-lg font-semibold">Status: <span id="statusText"
              class="text-emerald-600">Active</span></span>
        </div>
        <button id="toggleBtn"
          class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors">
          Pause
        </button>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <div class="bg-gray-50 rounded-lg p-4">
          <h3 class="font-semibold text-gray-700 mb-2">Next Event</h3>
          <p id="nextEvent" class="text-sm text-gray-600">Calculating...</p>
        </div>
        <div class="bg-gray-50 rounded-lg p-4">
          <h3 class="font-semibold text-gray-700 mb-2">Events Simulated</h3>
          <p id="eventCount" class="text-sm text-gray-600">0</p>
        </div>
      </div>

      <div class="flex flex-wrap gap-2">
        <button id="settingsBtn"
          class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm transition-colors">
          Settings
        </button>
        <button id="launchTeamsBtn"
          class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg text-sm transition-colors">
          Launch Teams
        </button>
        <!--         <button id="newMeetingBtn" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm transition-colors">
          New Meeting
        </button> -->
      </div>
    </div>

    <!-- Activity Log -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <h3 class="font-semibold text-gray-700 mb-3">Activity Log</h3>
      <div id="eventLog" class="h-48 overflow-y-auto bg-gray-50 rounded-lg p-3 text-xs space-y-1">
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md mx-4">
      <h2 class="text-xl font-bold text-gray-900 mb-4">Settings</h2>

      <!-- Event Types -->
      <div class="mb-6">
        <h3 class="font-semibold text-gray-700 mb-3">Event Types</h3>
        <div class="space-y-3">
          <label class="flex items-center">
            <input type="checkbox" id="enableMouseMove" checked
              class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
            <span class="ml-2 text-sm">Mouse movements</span>
          </label>
          <label class="flex items-center">
            <input type="checkbox" id="enableMouseClick" checked
              class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
            <span class="ml-2 text-sm">Mouse clicks</span>
          </label>
          <label class="flex items-center">
            <input type="checkbox" id="enableKeyPress" checked
              class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
            <span class="ml-2 text-sm">Key presses</span>
          </label>
          <label class="flex items-center">
            <input type="checkbox" id="enableScroll" checked
              class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
            <span class="ml-2 text-sm">Scrolling</span>
          </label>
        </div>
      </div>

      <!-- Frequency -->
      <div class="mb-6">
        <label for="eventFrequency" class="block font-semibold text-gray-700 mb-2">
          Event Frequency: <span id="freqValue" class="font-normal">15s</span>
        </label>
        <input type="range" id="eventFrequency" min="5" max="60" value="15"
          class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
        <div class="flex justify-between text-xs text-gray-500 mt-1">
          <span>5s</span>
          <span>60s</span>
        </div>
      </div>

      <!-- Buttons -->
      <div class="flex justify-end space-x-3">
        <button id="closeSettings"
          class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg text-sm transition-colors">
          Cancel
        </button>
        <button id="saveSettings"
          class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm transition-colors">
          Save
        </button>
      </div>
    </div>
  </div>

  <!-- Hidden video element for keeping page active -->
  <video class="hidden" autoplay loop muted playsinline>
    <source src="https://www.w3schools.com/html/mov_bbb.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>

  <script>
    // Configuration and state management
    let active = true;
    let eventCount = 0;
    let updateInterval;
    let nextScheduledTimes = {
      mouseMove: 0,
      mouseClick: 0,
      keyPress: 0,
      scroll: 0
    };

    // Settings with defaults
    let settings = {
      enableMouseMove: true,
      enableMouseClick: true,
      enableKeyPress: true,
      enableScroll: true,
      eventFrequency: 15
    };

    // DOM elements
    const statusText = document.getElementById('statusText');
    const statusIndicator = document.getElementById('statusIndicator');
    const toggleBtn = document.getElementById('toggleBtn');
    const eventLog = document.getElementById('eventLog');
    const eventCountEl = document.getElementById('eventCount');
    const nextEventSpan = document.getElementById('nextEvent');
    const settingsBtn = document.getElementById('settingsBtn');
    const settingsModal = document.getElementById('settingsModal');
    const closeSettings = document.getElementById('closeSettings');
    const saveSettings = document.getElementById('saveSettings');
    const freqSlider = document.getElementById('eventFrequency');
    const freqValue = document.getElementById('freqValue');
    const launchTeamsBtn = document.getElementById('launchTeamsBtn');
    const newMeetingBtn = document.getElementById('newMeetingBtn');

    // Load saved settings if available
    loadSettings();

    // Initialize settings UI
    function updateSettingsUI() {
      document.getElementById('enableMouseMove').checked = settings.enableMouseMove;
      document.getElementById('enableMouseClick').checked = settings.enableMouseClick;
      document.getElementById('enableKeyPress').checked = settings.enableKeyPress;
      document.getElementById('enableScroll').checked = settings.enableScroll;
      freqSlider.value = settings.eventFrequency;
      freqValue.textContent = `${settings.eventFrequency}s`;
    }

    // Load settings from localStorage
    function loadSettings() {
      const savedSettings = localStorage.getItem('keepTeamsActiveSettings');
      if (savedSettings) {
        settings = { ...settings, ...JSON.parse(savedSettings) };
      }
      updateSettingsUI();
    }

    // Save settings to localStorage
    function saveSettingsToStorage() {
      settings.enableMouseMove = document.getElementById('enableMouseMove').checked;
      settings.enableMouseClick = document.getElementById('enableMouseClick').checked;
      settings.enableKeyPress = document.getElementById('enableKeyPress').checked;
      settings.enableScroll = document.getElementById('enableScroll').checked;
      settings.eventFrequency = parseInt(freqSlider.value);

      localStorage.setItem('keepTeamsActiveSettings', JSON.stringify(settings));

      // Restart intervals with new settings
      if (active) {
        clearAllIntervals();
        startIntervals();
        logEvent("Settings updated, simulation restarted");
      } else {
        logEvent("Settings updated");
      }
    }

    // Helper function to get randomized timing
    function getRandomTiming() {
      // Base frequency from settings with Â±25% variation
      const baseTime = settings.eventFrequency * 1000;
      const variance = baseTime * 0.25;
      return baseTime + (Math.random() * variance * 2 - variance);
    }

    // Get a random position within the viewport
    function getRandomPosition() {
      return {
        x: Math.floor(Math.random() * window.innerWidth),
        y: Math.floor(Math.random() * window.innerHeight)
      };
    }

    // Microsoft Teams URL handlers
    function launchTeams() {
      window.open('https://teams.microsoft.com/', '_blank');
      logEvent("Microsoft Teams launched in new tab");
    }

    function createNewMeeting() {
      window.open('https://teams.microsoft.com/_#/calendarv2/createmeeting', '_blank');
      logEvent("Microsoft Teams meeting creation opened in new tab");
    }

    // Simulates mouse movement with random positions
    function simulateMouseMove() {
      if (!active || !settings.enableMouseMove) return;

      const pos = getRandomPosition();
      const evt = new MouseEvent("mousemove", {
        clientX: pos.x,
        clientY: pos.y,
        bubbles: true,
        cancelable: true,
        view: window
      });
      document.dispatchEvent(evt);

      eventCount++;
      updateEventCount();
      logEvent("Mouse movement simulated");

      // Schedule next event with randomized timing
      if (active && settings.enableMouseMove) {
        const nextDelay = getRandomTiming();
        nextScheduledTimes.mouseMove = Date.now() + nextDelay;
        setTimeout(simulateMouseMove, nextDelay);
      } else {
        nextScheduledTimes.mouseMove = 0;
      }

      updateNextEventTime();
    }

    // Simulates mouse click
    function simulateMouseClick() {
      if (!active || !settings.enableMouseClick) return;

      const pos = getRandomPosition();
      const evt = new MouseEvent("click", {
        clientX: pos.x,
        clientY: pos.y,
        bubbles: true,
        cancelable: true,
        view: window
      });
      document.dispatchEvent(evt);

      eventCount++;
      updateEventCount();
      logEvent("Mouse click simulated");

      // Schedule next event with randomized timing
      if (active && settings.enableMouseClick) {
        const nextDelay = getRandomTiming() * 2; // Less frequent than moves
        nextScheduledTimes.mouseClick = Date.now() + nextDelay;
        setTimeout(simulateMouseClick, nextDelay);
      } else {
        nextScheduledTimes.mouseClick = 0;
      }

      updateNextEventTime();
    }

    // Simulates a key press (random keys)
    function simulateKeyPress() {
      if (!active || !settings.enableKeyPress) return;

      // Array of safe keys to simulate
      const keys = ['Shift', 'Control', 'Alt', 'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'];
      const randomKey = keys[Math.floor(Math.random() * keys.length)];

      const evt = new KeyboardEvent("keydown", {
        key: randomKey,
        code: randomKey + "Left",
        bubbles: true
      });
      document.dispatchEvent(evt);

      eventCount++;
      updateEventCount();
      logEvent(`Key press (${randomKey}) simulated`);

      // Schedule next event with randomized timing
      if (active && settings.enableKeyPress) {
        const nextDelay = getRandomTiming() * 1.5;
        nextScheduledTimes.keyPress = Date.now() + nextDelay;
        setTimeout(simulateKeyPress, nextDelay);
      } else {
        nextScheduledTimes.keyPress = 0;
      }

      updateNextEventTime();
    }

    // Simulates scrolling
    function simulateScroll() {
      if (!active || !settings.enableScroll) return;

      const scrollAmount = Math.floor(Math.random() * 100) - 50; // Random between -50 and 50
      const evt = new WheelEvent("wheel", {
        deltaY: scrollAmount,
        bubbles: true
      });
      document.dispatchEvent(evt);

      eventCount++;
      updateEventCount();
      logEvent("Scroll event simulated");

      // Schedule next event with randomized timing
      if (active && settings.enableScroll) {
        const nextDelay = getRandomTiming() * 2.5;
        nextScheduledTimes.scroll = Date.now() + nextDelay;
        setTimeout(simulateScroll, nextDelay);
      } else {
        nextScheduledTimes.scroll = 0;
      }

      updateNextEventTime();
    }

    // Update event count display
    function updateEventCount() {
      eventCountEl.textContent = eventCount.toLocaleString();
    }

    // Log events to the UI
    function logEvent(message) {
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = document.createElement('div');
      logEntry.className = 'text-gray-600 py-1 border-b border-gray-200 last:border-b-0';
      logEntry.textContent = `${timestamp}: ${message}`;
      // TODO: add this if needed
      // eventLog.prepend(logEntry);

      // // Limit log entries
      // if (eventLog.children.length > 50) {
      //   eventLog.removeChild(eventLog.lastChild);
      // }
    }

    // Update the countdown to next event
    function updateNextEventTime() {
      const now = Date.now();
      let nextTimes = [];

      // Only include enabled and scheduled events
      if (settings.enableMouseMove && nextScheduledTimes.mouseMove > now) {
        nextTimes.push(nextScheduledTimes.mouseMove - now);
      }
      if (settings.enableMouseClick && nextScheduledTimes.mouseClick > now) {
        nextTimes.push(nextScheduledTimes.mouseClick - now);
      }
      if (settings.enableKeyPress && nextScheduledTimes.keyPress > now) {
        nextTimes.push(nextScheduledTimes.keyPress - now);
      }
      if (settings.enableScroll && nextScheduledTimes.scroll > now) {
        nextTimes.push(nextScheduledTimes.scroll - now);
      }

      if (nextTimes.length === 0) {
        nextEventSpan.textContent = "No events scheduled";
        return;
      }

      const nextEvent = Math.min(...nextTimes);
      nextEventSpan.textContent = `Next event in ${Math.ceil(nextEvent / 1000)}s`;
    }

    // Clear all intervals and reset scheduled times
    function clearAllIntervals() {
      clearInterval(updateInterval);
      nextScheduledTimes = {
        mouseMove: 0,
        mouseClick: 0,
        keyPress: 0,
        scroll: 0
      };
    }

    // Toggle active state
    function toggleActive() {
      active = !active;

      if (active) {
        statusText.textContent = "Active";
        statusText.className = "text-emerald-600";
        statusIndicator.className = "w-3 h-3 bg-emerald-500 rounded-full animate-pulse";
        toggleBtn.textContent = "Pause";

        // Restart intervals
        startIntervals();
        logEvent("Simulation activated");
      } else {
        statusText.textContent = "Paused";
        statusText.className = "text-red-600";
        statusIndicator.className = "w-3 h-3 bg-red-500 rounded-full";
        toggleBtn.textContent = "Resume";

        // Clear intervals
        clearAllIntervals();
        nextEventSpan.textContent = "Simulation paused";
        logEvent("Simulation paused");
      }
    }

    // Start all intervals
    function startIntervals() {
      // Start update interval for countdown
      updateInterval = setInterval(updateNextEventTime, 1000);

      // Start each enabled event type with its own timing
      if (settings.enableMouseMove) {
        const delay = 1000;
        nextScheduledTimes.mouseMove = Date.now() + delay;
        setTimeout(simulateMouseMove, delay);
      }
      if (settings.enableMouseClick) {
        const delay = 2000;
        nextScheduledTimes.mouseClick = Date.now() + delay;
        setTimeout(simulateMouseClick, delay);
      }
      if (settings.enableKeyPress) {
        const delay = 3000;
        nextScheduledTimes.keyPress = Date.now() + delay;
        setTimeout(simulateKeyPress, delay);
      }
      if (settings.enableScroll) {
        const delay = 4000;
        nextScheduledTimes.scroll = Date.now() + delay;
        setTimeout(simulateScroll, delay);
      }

      // Initial update
      updateNextEventTime();
    }

    // Setup event listeners
    toggleBtn.addEventListener('click', toggleActive);
    settingsBtn.addEventListener('click', () => {
      updateSettingsUI();
      settingsModal.classList.remove('hidden');
    });
    closeSettings.addEventListener('click', () => {
      settingsModal.classList.add('hidden');
    });
    saveSettings.addEventListener('click', () => {
      saveSettingsToStorage();
      settingsModal.classList.add('hidden');
    });
    freqSlider.addEventListener('input', () => {
      freqValue.textContent = `${freqSlider.value}s`;
    });

    // Microsoft Teams button event listeners
    launchTeamsBtn.addEventListener('click', launchTeams);
    newMeetingBtn.addEventListener('click', createNewMeeting);

    // Close modal when clicking outside
    settingsModal.addEventListener('click', (e) => {
      if (e.target === settingsModal) {
        settingsModal.classList.add('hidden');
      }
    });

    // Initial setup
    startIntervals();
    logEvent("Keep Teams Active application started");
    updateEventCount();
  </script>
</body>

</html>